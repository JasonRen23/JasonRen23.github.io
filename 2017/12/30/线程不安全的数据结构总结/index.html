<!DOCTYPE HTML><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><title>线程不安全的数据结构 | JasonRen&#39;s Blog</title><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="author" content="JasonRen"><meta name="description" content="什么是线程安全正确性当多个线程访问某个类时，不管运行时环境采用何种调度方式或者这些线程将如何交替执行，并且在主调代码中不需要任何额外的同步或协同，这个类都能表现出正确的行为，那么就称这个类是线程安全的。同步在线程安全类中封装了必要的同步机制，因此客户端无须进一步采用同步措施。"><meta name="keywords" content="并发"><meta property="og:type" content="article"><meta property="og:title" content="线程不安全的数据结构"><meta property="og:url" content="https://jasonren.top/2017/12/30/线程不安全的数据结构总结/index.html"><meta property="og:site_name" content="JasonRen&#39;s Blog"><meta property="og:description" content="什么是线程安全正确性当多个线程访问某个类时，不管运行时环境采用何种调度方式或者这些线程将如何交替执行，并且在主调代码中不需要任何额外的同步或协同，这个类都能表现出正确的行为，那么就称这个类是线程安全的。同步在线程安全类中封装了必要的同步机制，因此客户端无须进一步采用同步措施。"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://ws1.sinaimg.cn/large/73d640f7gy1ftl9uridvrj20oc030dfu.jpg"><meta property="og:image" content="https://ws1.sinaimg.cn/large/73d640f7gy1ftl9vva3yaj20zs0aft9n.jpg"><meta property="og:updated_time" content="2018-11-22T07:51:49.934Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="线程不安全的数据结构"><meta name="twitter:description" content="什么是线程安全正确性当多个线程访问某个类时，不管运行时环境采用何种调度方式或者这些线程将如何交替执行，并且在主调代码中不需要任何额外的同步或协同，这个类都能表现出正确的行为，那么就称这个类是线程安全的。同步在线程安全类中封装了必要的同步机制，因此客户端无须进一步采用同步措施。"><meta name="twitter:image" content="https://ws1.sinaimg.cn/large/73d640f7gy1ftl9uridvrj20oc030dfu.jpg"><link rel="alternative" href="/atom.xml" title="JasonRen&#39;s Blog" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="apple-touch-icon" href="/img/cat.png"><link rel="apple-touch-icon-precomposed" href="/img/cat.png"><link rel="stylesheet" href="/css/style.css"></head></html><body><header><div><div id="imglogo"><a href="/"><img src="/img/cat.png" alt="JasonRen&#39;s Blog" title="JasonRen&#39;s Blog"></a></div><div id="textlogo"><h1 class="site-name"><a href="/" title="JasonRen&#39;s Blog">JasonRen&#39;s Blog</a></h1><h2 class="blog-motto">Hello World!</h2></div><div class="navbar"><a class="navbutton navmobile" href="#" title="Menu"></a></div><nav class="animated"><ul><ul><li><a href="/">主页|Home</a></li><li><a href="/archives">归档|Archives</a></li><li><a href="/about">关于|About</a></li><li><form class="search" action="//google.com/search" method="get" accept-charset="utf-8"><label>Search</label> <input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search"> <input type="hidden" name="q" value="site:jasonren.top"></form></li></ul></ul></nav></div></header><div id="container"><div id="main" class="post" itemscope itemprop="blogPost"><article itemprop="articleBody"><header class="article-info clearfix"><h1 itemprop="name"><a href="/2017/12/30/线程不安全的数据结构总结/" title="线程不安全的数据结构" itemprop="url">线程不安全的数据结构</a></h1><p class="article-author">By <a href="/about" title="JasonRen" target="_blank" itemprop="author">JasonRen</a></p><p class="article-time"><time datetime="2017-12-29T16:00:00.000Z" itemprop="datePublished">Published 2017-12-30</time></p></header><div class="article-content"><div id="toc" class="toc-article"><strong class="toc-title">Contents</strong><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是线程安全"><span class="toc-number">1.</span> <span class="toc-text">什么是线程安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#正确性"><span class="toc-number">1.1.</span> <span class="toc-text">正确性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#同步"><span class="toc-number">1.2.</span> <span class="toc-text">同步</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常用的线程安全场景"><span class="toc-number">2.</span> <span class="toc-text">常用的线程安全场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#并发下的ArrayList"><span class="toc-number">3.</span> <span class="toc-text">并发下的ArrayList</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#并发下诡异的HashMap"><span class="toc-number">4.</span> <span class="toc-text">并发下诡异的HashMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考链接"><span class="toc-number">5.</span> <span class="toc-text">参考链接</span></a></li></ol></div><h2 id="什么是线程安全"><a href="#什么是线程安全" class="headerlink" title="什么是线程安全"></a>什么是线程安全</h2><h3 id="正确性"><a href="#正确性" class="headerlink" title="正确性"></a>正确性</h3><blockquote><p>当多个线程访问某个类时，不管运行时环境采用何种调度方式或者这些线程将如何交替执行，并且在主调代码中不需要任何额外的同步或协同，这个类都能表现出正确的行为，那么就称这个类是线程安全的。</p></blockquote><h3 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h3><blockquote><p>在线程安全类中封装了必要的同步机制，因此客户端无须进一步采用同步措施。</p></blockquote><a id="more"></a><h2 id="常用的线程安全场景"><a href="#常用的线程安全场景" class="headerlink" title="常用的线程安全场景"></a>常用的线程安全场景</h2><ol><li><strong>无状态的一定是线程安全的</strong>。这个很好理解，因为所谓线程不安全也就是一个线程修改了状态，而另一个线程的操作依赖于这个被修改的状态。</li><li><strong>只有一个状态，而且这个状态是由一个线程安全的对象维护的，那这个类也是线程安全的</strong>。比如你在数据结构里只用一个AtomicLong来作为计数器，那递增计数的操作都是线程安全的，不会漏掉任何一次计数，而如果你用普通的long做++操作则不一样，因为++操作本身涉及到取数、递增、赋值 三个操作，某个线程可能取到了另外一个线程还没来得及写回的数就会导致上一次写入丢失。</li><li><strong>有多个状态的情况下，维持不变性（invariant）的所有可变（mutable）状态都用同一个锁来守护的类是线程安全的</strong>。这一段有些拗口，首先类不变性的意思是指这个类在多线程状态下能正确运行的状态，其次用锁守护的意思是所有对该状态的操作都需要获取这个锁，而用同一个锁守护的作用就是所有对这些状态的修改实际最后都是串行的，不会存在某个操作中间状态被其他操作可见，继而导致线程不安全。所以这里的关键在于如何确定不变性，可能你的类的某些状态对于类的正确运行是无关紧要的，那就不需要用和其他状态一样的锁来守护。因此我们常可以看到有的类里面会创建一个新的对象作为锁来守护某些和原类本身不变性无关的状态。</li></ol><p>上面这三种只是一种归纳，具体到实际应用时，要看你的类哪些状态是必须用锁来守护的，灵活变通。</p><h2 id="并发下的ArrayList"><a href="#并发下的ArrayList" class="headerlink" title="并发下的ArrayList"></a>并发下的ArrayList</h2><p>ArrayList是一个线程不安全的容器，具体表现请看下面这段代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayListMultiThread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> ArrayList&lt;Integer&gt; al = <span class="keyword">new</span> ArrayList&lt;Integer&gt;(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AddThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++)&#123;</span><br><span class="line">                al.add(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> AddThread());</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> AddThread());</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t1.join();t2.join();</span><br><span class="line">        System.out.println(al.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述代码实现的是采用t1和t2两个线程向一个ArrayList容器中添加元素，最后我们期望可以有2000000个元素在ArrayList中，但事与愿违，你将得到以下三种结果：</p><ol><li><p>跟你期待的一样，最后打印结果为2000000。</p></li><li><p>抛数组越界异常：<br><img src="https://ws1.sinaimg.cn/large/73d640f7gy1ftl9uridvrj20oc030dfu.jpg" alt=""></p><p>这是由于ArrayList扩容过程中，内部一致性遭到破坏，但由于没有锁的保护，当另一个线程访问到了不一致的内部状态，导致出现越界问题。</p></li><li><p>第三种情况是最为头疼的情况，因为它并没有报错：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1321889</span></span><br></pre></td></tr></table></figure></li></ol><p>显然这是由于多线程之间的访问冲突，使得保存容器大小的变量被多线程不正常的访问，同时两个线程也同时对ArrayList中的同一个位置进行赋值导致的。<br><br>解决方法很简单，只需要将ArrayList换成线程安全的容器vector即可。</p><h2 id="并发下诡异的HashMap"><a href="#并发下诡异的HashMap" class="headerlink" title="并发下诡异的HashMap"></a>并发下诡异的HashMap</h2><p>HashMap同样不是线程安全的，当你使用多线程访问HashMap时也会遇到意想不到的错误：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashMapMultiThread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Map&lt;String, String&gt;map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AddThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">AddThread</span><span class="params">(<span class="keyword">int</span> start)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.start = start;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = start; i &lt; <span class="number">100000</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">                map.put(Integer.toString(i), Integer.toBinaryString(i));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> HashMapMultiThread.AddThread(<span class="number">0</span>));</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> HashMapMultiThread.AddThread(<span class="number">1</span>));</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t1.join();t2.join();</span><br><span class="line">        System.out.println(map.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果运行正常会打印100000，但是你可能得到以下两种意外结果：</p><ol><li><p>程序正常结束，但得到一个比100000小的数字，比如95868。</p></li><li><p><del>程序永远无法结束，这在JDK8中已经不存在，详细原因可以查看此<a href="https://coolshell.cn/articles/9606.html" target="_blank" rel="noopener">传送门</a></del>。</p></li><li><p>抛异常：</p><p><img src="https://ws1.sinaimg.cn/large/73d640f7gy1ftl9vva3yaj20zs0aft9n.jpg" alt=""></p></li></ol><p>异常的大概意思HashMap.Node与HashMap.TreeNode进行了异常映射。</p><p><a href="https://stackoverflow.com/questions/29967401/strange-hashmap-exception-hashmapnode-cannot-be-cast-to-hashmaptreenode/29971168" target="_blank" rel="noopener">stackoverflow</a>有两个回答解释得比较好：</p><p>As you can see Java 8’s HashMap has a method called <code>treeify</code> to improve internal storage. Since you’re not using the map in a threadsafe way (as the others already commented) one thread relies on an entry being of class <code>TreeNode</code> while the other most probably changed the same reference to an entry which was of class <code>Node</code> (both extend <code>Map.Entry</code>). – <a href="https://stackoverflow.com/users/637853/thomas" target="_blank" rel="noopener">Thomas</a></p><p>I also found the same exception with your code. I added a <code>synchronized</code> modifier on the <code>putEntriesToMap()</code> method, and the error seemed to stop occurring. The problem is that both threads are modifying the same map at once. There is an object that must be converted to put the entry in. However, the second thread is dealing with a mutated object, which throws a <code>ClassCastException</code>. So, make sure that no two threads are accessing the same map at once. The <code>synchronized</code> modifier stops all other threads from doing anything with the class/instance if another thread is doing the same. Synchronized static methods synchronize the class itself, whereas synchronized non-static methods only synchronize the instance of the class.–<a href="https://stackoverflow.com/users/8200485/hyperneutrino" target="_blank" rel="noopener">HyperNeutrino</a></p><p>JDK7中HashMap采用的是位桶+链表的方式。而JDK8中采用的是位桶+链表/红黑树的方式，当某个位桶的链表的长度超过8的时候，这个链表就将转换成红黑树。链表转换红黑树在treeify方法里实现。Node和TreeNode都继承自Map.Entry这个内部接口，所以若map在线程非安全的情况下进行操作，一个线程依赖TreeNode这个类的接口进行存储，而另一个线程又在相同的位置采用Node类的接口进行修改，则会产生如上错误。</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol><li><a href="https://coolshell.cn/articles/9606.html" target="_blank" rel="noopener">https://coolshell.cn/articles/9606.html</a></li><li><a href="https://stackoverflow.com/questions/29967401/strange-hashmap-exception-hashmapnode-cannot-be-cast-to-hashmaptreenode/29971168" target="_blank" rel="noopener">https://stackoverflow.com/questions/29967401/strange-hashmap-exception-hashmapnode-cannot-be-cast-to-hashmaptreenode/29971168</a></li><li><a href="https://www.jianshu.com/p/4177dc15d658" target="_blank" rel="noopener">https://www.jianshu.com/p/4177dc15d658</a></li><li><a href="https://www.zhihu.com/question/26595480" target="_blank" rel="noopener">https://www.zhihu.com/question/26595480</a></li></ol></div><footer class="article-footer clearfix"><div class="article-catetags"><div class="article-categories"><span></span> <a class="article-category-link" href="/categories/Java/">Java</a></div><div class="article-tags"><span></span> <a href="/tags/并发/">并发</a></div></div><div class="article-share" id="share"><div data-url="https://jasonren.top/2017/12/30/线程不安全的数据结构总结/" data-title="线程不安全的数据结构 | JasonRen&#39;s Blog" data-tsina="null" class="share clearfix"></div></div></footer></article><nav class="article-nav clearfix"><div class="prev"><a href="/2018/01/31/数据库锁机制/" title="数据库锁机制[转]"><strong>上一篇：</strong><br><span>数据库锁机制[转]</span></a></div><div class="next"><a href="/2017/12/26/hexo-fixed-sidebartoc/" title="melody sidebar侧栏toc显示问题"><strong>下一篇：</strong><br><span>melody sidebar侧栏toc显示问题</span></a></div></nav><section id="comments" class="comment"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></div><div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div><div id="toc" class="toc-aside"><strong class="toc-title">Contents</strong><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是线程安全"><span class="toc-number">1.</span> <span class="toc-text">什么是线程安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#正确性"><span class="toc-number">1.1.</span> <span class="toc-text">正确性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#同步"><span class="toc-number">1.2.</span> <span class="toc-text">同步</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常用的线程安全场景"><span class="toc-number">2.</span> <span class="toc-text">常用的线程安全场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#并发下的ArrayList"><span class="toc-number">3.</span> <span class="toc-text">并发下的ArrayList</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#并发下诡异的HashMap"><span class="toc-number">4.</span> <span class="toc-text">并发下诡异的HashMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考链接"><span class="toc-number">5.</span> <span class="toc-text">参考链接</span></a></li></ol></div><div id="asidepart"><div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div><aside class="clearfix"><div class="github-card"><p class="asidetitle">Github Card</p><div class="github-card" data-github="JasonRen23" data-theme="medium"></div><script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script></div><div class="categorieslist"><p class="asidetitle">Categories</p><ul><li><a href="/categories/IDE/" title="IDE">IDE<sup>1</sup></a></li><li><a href="/categories/Java/" title="Java">Java<sup>12</sup></a></li><li><a href="/categories/Python/" title="Python">Python<sup>2</sup></a></li><li><a href="/categories/linux/" title="linux">linux<sup>1</sup></a></li><li><a href="/categories/前端/" title="前端">前端<sup>3</sup></a></li><li><a href="/categories/容器云/" title="容器云">容器云<sup>2</sup></a></li><li><a href="/categories/搜索引擎/" title="搜索引擎">搜索引擎<sup>1</sup></a></li><li><a href="/categories/操作系统/" title="操作系统">操作系统<sup>1</sup></a></li><li><a href="/categories/数据库/" title="数据库">数据库<sup>2</sup></a></li><li><a href="/categories/消息队列/" title="消息队列">消息队列<sup>1</sup></a></li><li><a href="/categories/算法/" title="算法">算法<sup>1</sup></a></li><li><a href="/categories/计算机网络/" title="计算机网络">计算机网络<sup>1</sup></a></li></ul></div><div class="tagslist"><p class="asidetitle">Tags</p><ul class="clearfix"><li><a href="/tags/并发/" title="并发">并发<sup>6</sup></a></li><li><a href="/tags/JVM/" title="JVM">JVM<sup>3</sup></a></li><li><a href="/tags/Meteor/" title="Meteor">Meteor<sup>2</sup></a></li><li><a href="/tags/mongodb/" title="mongodb">mongodb<sup>2</sup></a></li><li><a href="/tags/Web技术/" title="Web技术">Web技术<sup>2</sup></a></li><li><a href="/tags/Maven/" title="Maven">Maven<sup>1</sup></a></li><li><a href="/tags/Spring/" title="Spring">Spring<sup>1</sup></a></li><li><a href="/tags/TCP-UDP/" title="TCP/UDP">TCP/UDP<sup>1</sup></a></li><li><a href="/tags/hexo/" title="hexo">hexo<sup>1</sup></a></li><li><a href="/tags/docker/" title="docker">docker<sup>1</sup></a></li><li><a href="/tags/Kafka/" title="Kafka">Kafka<sup>1</sup></a></li><li><a href="/tags/redis/" title="redis">redis<sup>1</sup></a></li><li><a href="/tags/sublime/" title="sublime">sublime<sup>1</sup></a></li><li><a href="/tags/shell脚本/" title="shell脚本">shell脚本<sup>1</sup></a></li><li><a href="/tags/Solr/" title="Solr">Solr<sup>1</sup></a></li><li><a href="/tags/快速排序/" title="快速排序">快速排序<sup>1</sup></a></li><li><a href="/tags/连接池/" title="连接池">连接池<sup>1</sup></a></li><li><a href="/tags/SQL/" title="SQL">SQL<sup>1</sup></a></li><li><a href="/tags/kubernetes/" title="kubernetes">kubernetes<sup>1</sup></a></li><li><a href="/tags/线程与进程/" title="线程与进程">线程与进程<sup>1</sup></a></li></ul></div><div class="rsspart"><a href="/atom.xml" target="_blank" title="rss">RSS</a></div></aside></div></div><footer><div id="footer"><div class="line"><span></span><div class="author"></div></div><section class="info"><p>Hello, I&#39;m JasonRen in Shu.<br>This is my blog, my mind.</p></section><div class="social-font"><a href="https://github.com/JasonRen23" target="_blank" class="icon-github" title="github"></a> <a href="http://www.zhihu.com/people/ren-zhi-cheng-1117" target="_blank" class="icon-zhihu" title="知乎"></a> <a href="mailto:zhicheng_ren@163.com" target="_blank" class="icon-email" title="Email Me"></a></div><p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 <a href="/about" target="_blank" title="JasonRen">JasonRen</a></p></div></footer><script src="/js/jquery-2.0.3.min.js"></script><script src="/js/jquery.imagesloaded.min.js"></script><script src="/js/gallery.js"></script><script src="/js/jquery.qrcode-0.12.0.min.js"></script><script type="text/javascript">$(document).ready(function(){$(".navbar").click(function(){$("header nav").toggleClass("shownav")});var e=0,s=$("#main"),n=$("#asidepart"),a=$(".closeaside"),o=$(".openaside");a.click(function(){n.addClass("fadeOut").css("display","none"),o.css("display","block").addClass("fadeIn"),s.addClass("moveMain")}),o.click(function(){o.css("display","none").removeClass("beforeFadeIn"),n.css("display","block").removeClass("fadeOut").addClass("fadeIn"),s.removeClass("moveMain")}),$(window).scroll(function(){o.css("top",Math.max(80,260-$(this).scrollTop()))}),$(window).resize(function(){"number"==typeof window.innerWidth?e=window.innerWidth:document.documentElement&&document.documentElement.clientWidth&&(e=document.documentElement.clientWidth),1024<=e?$("header nav").removeClass("shownav"):(s.removeClass("moveMain"),n.css("display","block").removeClass("fadeOut"),o.css("display","none"),$("#toc.toc-aside").css("display","none"))})})</script><script type="text/javascript">$(document).ready(function(){var c=$(".article-content>iframe"),n=$(".article-content>embed"),o=($("#toc"),$("#toc.toc-aside")),e=$(".openaside"),i=$(".closeaside");0<c.length&&c.wrap('<div class="video-container" />'),0<n.length&&n.wrap('<div class="video-container" />'),i.click(function(){o.css("display","block").addClass("fadeIn")}),e.click(function(){o.css("display","none")}),$(window).scroll(function(){o.css("top",Math.max(140,320-$(this).scrollTop()))})})</script><script type="text/javascript">$(document).ready(function(){var e=$(".share"),a=e.attr("data-url"),t=encodeURIComponent(a),r=e.attr("data-title"),i=e.attr("data-tsina"),c=(e.attr("description"),['<div class="hoverqrcode clearfix"></div>','<a class="overlay" id="qrcode"></a>','<a href="https://www.facebook.com/sharer.php?u='+t+'" class="article-share-facebook" target="_blank" title="Facebook"></a>','<a href="https://twitter.com/intent/tweet?url='+t+'" class="article-share-twitter" target="_blank" title="Twitter"></a>','<a href="#qrcode" class="article-share-qrcode" title="微信"></a>','<a href="http://widget.renren.com/dialog/share?resourceUrl='+t+"&srcUrl="+t+"&title="+r+'" class="article-share-renren" target="_blank" title="人人"></a>','<a href="http://service.weibo.com/share/share.php?title='+r+"&url="+t+"&ralateUid="+i+'&searchPic=true&style=number" class="article-share-weibo" target="_blank" title="微博"></a>','<span title="Share to"></span>'].join(""));e.append(c),$(".hoverqrcode").hide();var o=0;$(window).resize(function(){$(".hoverqrcode").hide()}),$(".article-share-qrcode").click(function(){!function(){"number"==typeof window.innerWidth?o=window.innerWidth:document.documentElement&&document.documentElement.clientWidth&&(o=document.documentElement.clientWidth);var e=1024<o?200:100,t={render:"image",size:e,fill:"#2ca6cb",text:a,radius:.5,quiet:1},r=$(".article-share-qrcode").position();$(".hoverqrcode").empty().css("width",e).css("height",e).css("left",r.left-e/2+20).css("top",r.top-e-10).qrcode(t)}(),$(".hoverqrcode").toggle()}),$(".article-share-qrcode").hover(function(){},function(){$(".hoverqrcode").hide()})})</script><script type="text/javascript">var disqus_shortname="jasonren";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}(),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/count.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript">$(document).ready(function(){$(".article-content").each(function(a){$(this).find("img").each(function(){if(!$(this).parent().hasClass("fancybox")){var a=this.alt;a&&$(this).after('<span class="caption">'+a+"</span>"),$(this).wrap('<a href="'+this.src+'" title="'+a+'" class="fancybox"></a>')}}),$(this).find(".fancybox").each(function(){$(this).attr("rel","article"+a)})}),$.fancybox&&$(".fancybox").fancybox()})</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div id="totop"><a title="Back to Top"><img src="/img/scrollup.png"></a></div><script src="/js/totop.js"></script></body>