---
title: 数据库连接池
date: 2018-08-10
categories: Java
tags: 连接池
---
## 什么情况使用连接池
对于一个简单的数据库应用，由于对于数据库的访问不是很频繁。这时可以简单地在需要访问数据库时，就新创建一个连接，用完后就关闭它，这样做也不会带来什么明显的性能上的开销。但是对于一个复杂的数据库应用，情况就完全不同了。频繁的建立、关闭连接，会极大的减低系统的性能，因为对于连接的使用成了系统性能的瓶颈。

## 使用连接池的好处
1. 连接复用。通过建立一个数据库连接池以及一套连接使用管理策略，使得一个数据库连接可以得到高效、安全的复用，避免了数据库连接频繁建立、关闭的开销。
2. 对于共享资源，有一个很著名的设计模式：资源池。该模式正是为了解决资源频繁分配、释放所造成的问题的。把该模式应用到数据库连接管理领域，就是建立一个数据库连接池，提供一套高效的连接分配、使用策略，最终目标是实现连接的高效、安全的复用。

<!-- more -->

## 选型对比

功能 | C3P0| DBCP| Druid | 
---|---|---|---
线程同步|单线程|单线程|多线程、异步
PSCache | 是|是|是|
LRU |否|是|是|
ExceptionSorted |否|否|是|
监控|jmx/log|jmx|jmx/log/http|
扩展性|弱|弱|好|
SQL拦截及解析|无|无|支持|
代码复杂度|复杂|中等，超过60个类|复杂|
特点|历史久远，代码逻辑复杂，且不易维护 | 依赖于apache-common-pool|阿里开源，功能全面，为监控而生|
连接池管理|队列|LinkedBlockingDeque|数组/CopyOnWriteArrayList|
Tomcat数据源、JNDI|数据源和JNDI绑定，支持JDBC2和JDBC3的扩展|支持JNDI配置，需要加入jconn3.jar|支持JDNI配置，com.alibaba.druid.pool.DruidDataSourceFactory | 
更新维护|2015.12.09|2015.8.6|更新维护|

功能|Tomcat-JDBC| BoneCP | HikariCP
---|---|---|---
线程同步| 多线程、异步|多线程、异步|多线程、异步
PSCache |是|是|否
LRU |是|否|否
ExceptionSorted |否|否|否
监控|jmx|jmx|jmx/metrics
扩展性|弱|好|好
SQL拦截及解析|无|无|无
代码复杂度|简单，8个核心类|简单|简单
特点|异步、高性能、DBCP连接池的备选方案|性能是C3P0的25倍左右|优化力度大，功能简单，起源于BoneCP
连接池管理|FairBlockingQueue|堆栈|threadlocal/CopyOnWriteArrayList
Tomcat数据源、JNDI|支持JDNI配置，Tomcat的一个模块 | 支持JNDI配置，com.jolbox.bonecp.BoneCPDataSource|支持JDNI配置，HikariJNDIFactory
更新维护|更新维护|2015.6.25|更新维护

其中：

- `PSCache`是数据库连接池的关键指标。在Oracle中，类似SELECT NAME FROM USER WHERE ID = ?这样的SQL，启用PSCache和不启用PSCache的性能可能是相差一个数量级的。Proxool是不支持PSCache的数据库连接池，如果你使用Oracle、SQL Server、DB2、Sybase这样支持游标的数据库，那你就完全不用考虑Proxool。
- `ExceptionSorter`是一个很重要的容错特性，如果一个连接产生了一个不可恢复的错误，必须立刻从连接池中去掉，否则会连续产生大量错误。这个特性，目前只有JBossDataSource和Druid实现。Druid的实现参考自JBossDataSource，经过长期生产反馈补充。

## 参考链接
1. [常用数据库连接池配置说明](http://www.cnblogs.com/JavaSubin/p/5294721.html)
2. [主流数据库连接池全面对比](https://mp.weixin.qq.com/s/K4hNaPEfiw4dZiE7pw1Euw)